import scrapy


from voltstat.items import voltstatItem

class voltstatSpider(scrapy.Spider):
    name = "voltstat"
    allowed_domains = ["voltstats.net"]
    
    listae = [1,7,11,24,30,32,36,42,54,65,67,81,88,90,92,98,101,107,191,193,197,202,205,209,226,236,253,256,258,259,274,282,284,285,286,292,302,313,319,333,334,336,350,354,357,363,366,371,384,385,387,390,394,412,414,424,428,434,441,442,446,461,464,471,485,490,492,504,510,512,521,529,535,536,543,546,548,552,553,555,570,578,586,588,589,590,604,619,627,628,635,641,642,644,645,646,649,652,657,672,679,680,683,688,696,701,702,704,709,712,720,722,724,726,742,744,747,750,752,754,755,764,769,775,778,798,799,819,828,830,836,848,851,854,860,865,872,877,879,903,904,920,927,929,934,935,936,946,951,954,956,957,958,975,982,1005,1006,1008,1009,1010,1013,1017,1018,1020,1028,1031,1039,1053,1066,1068,1071,1072,1076,1080,1081,1083,1086,1102,1106,1130,1133,1134,1135,1138,1145,1165,1168,1170,1175,1177,1178,1180,1186,1188,1191,1192,1196,1197,1206,1215,1224,1226,1235,1242,1245,1247,1252,1255,1257,1259,1266,1267,1274,1278,1279,1290,1294,1304,1311,1316,1322,1323,1330,1338,1351,1360,1368,1378,1389,1390,1392,1394,1403,1407,1413,1414,1423,1427,1429,1430,1435,1437,1439,1442,1445,1473,1476,1481,1494,1502,1509,1512,1519,1524,1527,1533,1535,1545,1548,1552,1568,1575,1579,1593,1596,1604,1608,1609,1613,1617,1623,1624,1637,1640,1643,1656,1658,1665,1667,1669,1672,1673,1675,1676,1682,1683,1684,1691,1692,1694,1700,1703,1717,1719,1721,1722,1723,1727,1729,1752,1759,1767,1768,1772,1773,1778,1781,1782,1786,1789,1794,1796,1807,1809,1811,1818,1819,1822,1825,1826,1832,1841,1842,1844,1854,1860,1861,1863,1865,1868,1879,1881,1883,1891,1896,1897,1902,1916,1928,1942,1950,1956,1965,1966,1969,1979,1980,1986,1993,1998,2009,2013,2016,2024,2032,2034,2038,2040,2045,2054,2057,2058,2059,2062,2066,2079,2092,2097,2116,2124,2127,2130,2142,2143,2149,2153,2161,2165,2166,2169,2171,2175,2179,2182,2185,2186,2192,2194,2199,2200,2201,2202,2204,2205,2206,2209,2210,2221,2222,2223,2228,2230,2231,2232,2235,2237,2245,2251,2255,2257,2258,2261,2263,2264,2265,2267,2273,2289,2291,2294,2306,2309,2310,2312,2316,2317,2318,2325,2332,2333,2335,2345,2352,2357,2358,2362,2367,2372,2381,2387,2389,2399,2405,2407,2411,2414,2416,2421,2427,2430,2435,2437,2439,2440,2441,2446,2456,2457,2460,2465,2474,2482,2484,2488,2490,2491,2501,2502,2509,2510,2516,2520,2536,2537,2542,2543,2551,2554,2555,2556,2559,2561,2564,2574,2575,2576,2585,2586,2587,2593,2597,2601,2608,2616,2617,2625,2629,2630,2633,2635,2636,2651,2656,2657,2658,2660,2661,2663,2665,2671,2674,2682,2684,2694,2699,2702,2703,2705,2712,2726,2733,2737,2738,2741,2744,2745,2754,2756,2758,2759,2764,2765,2767,2769,2773,2779,2780,2796,2807,2812,2813,2817,2822,2823,2824,2825,2829,2831,2834,2837,2839,2840,2841,2843,2849,2855,2877,2896,2899,2900,2902,2906,2908,2910,2912,2913,2914,2916,2920,2934,2937,2939,2940,2951,2953,2969,2975,2977,2979,2982,2984,2986,2987,2995,2996,3000,3005,3010,3014,3016,3018,3020,3021,3022,3023,3025,3036,3043,3044,3053,3054,3056,3057,3063,3064,3068,3072,3073,3074,3077,3079,3083,3084,3086,3089,3090,3100,3103,3113,3114,3115,3116,3117,3128,3132,3134,3137,3138,3141,3142,3143,3148,3150,3154,3155,3158,3160,3163,3166,3173,3179,3188,3196,3200,3202,3207,3209,3210,3213,3217,3227,3233,3235,3241,3242,3244,3250,3253,3258,3259,3261,3271,3273,3276,3278,3279,3284,3297,3298,3300,3308,3311,3313,3321,3322,3325,3326,3328,3330,3339,3342,3344,3345,3349,3350,3352,3353,3355,3367,3370,3378,3380,3381,3384,3387,3395,3397,3399,3400,3401,3403,3405,3411,3412,3413,3421,3427,3428,3429,3430,3437,3443,3445,3446,3448,3449,3450,3451,3456,3458,3470,3472,3482,3490,3492,3494,3495,3500,3504,3507,3510,3513,3514,3516,3517,3518,3522,3526,3532,3533,3535,3546,3550,3551,3552,3559,3561,3564,3566,3568,3574,3575,3580,3582,3585,3588,3589,3590,3591,3592,3594,3595,3597,3604,3605,3606,3610,3612,3613,3614,3616,3617,3619,3620,3628,3629,3631,3633,3634,3640,3641,3643,3649,3650,3651,3665,3669,3671,3674,3682,3683,3689,3691,3692,3694,3696,3698,3699,3704,3711,3715,3717,3720,3723,3728,3731,3736,3741,3742,3745,3747,3758,3763,3765,3768,3771,3774,3777,3778,3779,3781,3793,3797,3799,3800,3801,3803,3805,3808,3810,3812,3814,3815,3817,3825,3836,3839,3841,3842,3843,3848,3849,3853,3855,3861,3862,3863,3865,3867,3876,3878,3879,3881,3882,3883,3885,3887,3889,3891,3893,3894,3896,3897,3899,3901,3906,3911,3916,3918,3919,3924,3930,3932,3934,3940,3941,3942,3946,3947,3953,3955,3956,3959,3960,3964,3965,3970,3971,3973,3974,3975,3984,3986,3987,3988,3989,3990,3992,3998,4000,4001,4008,4009,4010,4017,4019,4026,4027,4031,4034,4040,4047,4050,4056,4057,4059,4061,4062,4063,4065,4068,4071,4073,4074,4083,4085,4089,4092,4093,4099,4100,4102,4104,4105,4114,4117,4120,4123,4124,4125,4129,4131,4132,4133,4135,4136,4137,4140,4141,4144,4145,4148,4149,4156,4159,4161,4163,4164,4168,4169,4172,4173,4175,4176,4177,4179,4183,4185,4187,4188,4189,4190,4191,4193,4194,4205,4206,4208,4217,4218,4219,4222,4226,4227,4228,4231,4235,4242,4243,4244,4247,4249,4252,4253,4259,4262,4268,4269,4270,4272,4275,4276,4279,4280,4283,4284,4295,4296,4299,4302,4304,4308,4310,4311,4313,4320,4321,4329,4333,4334,4335,4336,4337,4338,4341,4344,4348,4349,4350,4351,4352,4356,4357,4358,4359,4360,4361,4369,4371,4372,4373,4376,4379,4380,4381,4383,4384,4386,4389,4393,4394,4395,4396,4398,4400,4402,4403,4404,4406,4407,4414,4415,4423,4424,4433,4434,4437,4438,4439,4446,4448,4449,4453,4457,4458,4464,4465,4466,4471,4472,4476,4477,4478,4482,4484,4486,4489,4490,4492,4497,4499,4500,4503,4504,4505,4508,4512,4513,4514,4520,4523,4524,4526,4527,4528,4531,4532,4536,4539,4541,4543,4549,4552,4554,4555,4556,4557,4558,4559,4560,4563,4565,4566,4567,4569,4571,4578,4581,4585,4591,4596,4598,4606,4607,4610,4618,4620,4622,4625,4630,4632,4634,4639,4641,4645,4646,4647,4648,4649,4650,4651,4652,4653,4657,4659,4661,4664,4665,4666,4669,4672,4673,4677,4679,4680,4692,4696,4697,4700,4701,4707,4708,4712,4716,4718,4722,4725,4726,4731,4735,4736,4739,4740,4741,4745,4746,4748,4749,4753,4755,4758,4761,4762,4767,4768,4772,4776,4779,4783,4786,4787,4791,4792,4798,4800,4807,4808,4809,4810,4815,4817,4818,4820,4824,4827,4831,4833,4835,4838,4839,4843,4844,4848,4855,4856,4857,4858,4860,4862,4864,4865,4867,4869,4876,4879,4889,4892,4898,4901,4904,4911,4912,4913,4916,4917,4920,4921,4932,4935,4939,4944,4946,4947,4950,4960,4966,4968,4971,4973,4975,4976,4978,4980,4981,4986,4988,4990,4998,5002,5003,5005,5009,5010,5016,5017,5019,5022,5026,5031,5035,5039,5040,5046,5047,5048,5053,5054,5055,5056,5057,5059,5060,5062,5063,5066,5068,5069,5072,5074,5077,5078,5081,5083,5087,5088,5094,5095,5096,5097,5102,5104,5105,5108,5110,5115,5118,5120,5121,5124,5125,5126,5127,5128,5131,5134,5138,5140,5142,5144,5145,5147,5148,5152,5154,5155,5156,5159,5164,5166,5171,5173,5177,5179,5182,5186,5187,5190,5192,5193,5195,5196,5202,5203,5205,5209,5210,5213,5216,5217,5218,5221,5222,5225,5227,5228,5232,5233,5234,5239,5241,5242,5243,5244,5246,5247,5255,5259,5261,5262,5263,5265,5266,5268,5271,5273,5274,5275,5277,5279,5281,5283,5288,5290,5291,5292,5293,5297,5299,5300,5307,5308,5309,5311,5314,5321,5322,5331,5333,5335,5340,5342,5347,5349,5352,5357,5358,5363,5366,5368,5370,5371,5374,5375,5377,5380,5381,5382,5383,5384,5386,5387,5389,5392,5394,5395,5398,5403,5407,5408,5409,5421,5434,5436,5437,5439,5440,5444,5445,5447,5449,5450,5451,5456,5457,5458,5459,5462,5463,5464,5470,5471,5475,5480,5481,5482,5483,5486,5487,5489,5490,5493,5495,5505,5508,5510,5511,5514,5516,5517,5518,5519,5520,5521,5522,5523,5525,5526,5527,5528,5533,5534,5536,5537,5538,5539,5540,5541,5542,5543,5544,5545,5546,5547,5548,5549,5550,5551,5552,5554,5556,5557,5558,5559,5560,5561,5562,5563,5564,5566,5568,5569,5570,5571,5572,5573,5574,5575,5576,5577,5578,5579,5580,5581,5583,5584,5585,5586,5587,5588,5591,5592,5593,5596,5597,5598,5599,5600,5601,5602,5603,5604,5605,5607,5608,5610,5611,5612,5614,5617,5618,5619,5620,5621,5622,5623,5624,5625,5626,5627,5628,5629,5630,5632,5633,5634,5635,5636,5637,5639,5640,5641,5643,5644,5645,5646,5647,5648,5649,5650,5651,5652,5653,5654,5655,5656,5657,5658,5659,5660,5661,5662,5663,5664,5665,5666,5667,5668,5669,5670,5671,5672,5673,5674,5675,5676,5677,5678,5679,5680,5681,5682,5683,5684,5685,5686,5687,5688,5689,5690,5691,5692,5693,5694,5695,5696,5697,5698,5699,5700,5701,5702,5703,5704,5705,5706,5707,5709,5710,5711,5713,5714,5715,5716,5717,5718,5720,5721,5724,5725,5727,5728,5729,5730,5731,5732,5733,5734,5735,5736,5738,5739,5740,5741,5742,5743,5744,5745,5746,5748,5749,5750,5752,5753,5754,5755,5756,5757,5758,5759,5760,5762,5763,5764,5765,5766,5767,5768,5769,5770,5772,5773,5774,5775,5776,5777,5778,5779,5780,5781,5782,5783,5784,5785,5786,5787,5789,5790,5791,5792,5793,5794,5797,5798,5800,5801,5802,5803,5804,5805,5806,5807,5808,5809,5810,5812,5814,5815,5816,5817,5818,5819,5820,5822,5823,5824,5825,5826,5827,5828,5829,5830,5832,5833,5834,5835,5836,5837,5838,5839,5840,5841,5842,5843,5844,5846,5847,5848,5849,5850,5851,5852,5853,5854,5855,5856,5857,5858,5860,5861,5862,5863,5864,5865,5866,5867,5868,5869,5870,5871,5872,5873,5874,5876,5877,5878,5879,5880,5881,5882,5883,5884,5885,5886,5887,5888,5889,5890,5891,5893,5894,5895,5896,5897,5898,5899,5900,5901,5902,5903,5904,5905,5906,5907,5908,5909,5910,5911,5912,5913,5915,5917]
    url_list=[]
    for y in range (0,len(listae)-1):
        url_list.append("file:///K:/e/user/kockat/.temp/" + str(listae[y]) + ".htm")
    start_urls = url_list
    #http://www.voltstats.net/Stats/Details/1505 
    # start_urls = ['file:///K:/e/user/kockat/.temp/1752.htm']
    # start_urls = ['http://www.voltstats.net/Stats/Details/1752']

    #===========================================================================
    # # from main page to subpages
    # def parse(self, response):
    #     for href in response.css("td.va-middle >  a::attr('href')"):    
    #         url = response.urljoin(href.extract())
    #         yield scrapy.Request(url, callback=self.parse_dir_contents)
    #     
    #     next_page = response.css("div.inner > a.page-next::attr('href')")
    #     if next_page:
    #         url = response.urljoin(next_page[0].extract())
    #         yield scrapy.Request(url, self.parse)
    #===========================================================================
   
    
    def parse(self, response):
        item = voltstatItem()  
        item['data'] = response.xpath('//script[contains(text(),"Sacknet.MileageGraph.SetupMileageGraph")]/text()').extract()
        yield item
        
        filepath = 'K:/e/user/kockat/.temp/output/'
        filename = response.url.split("/")[-1].split('.')[0]  + '.csv'
        with open(filepath + filename, 'wb') as f:
            f.write(('\n').join(item['data']))

            
